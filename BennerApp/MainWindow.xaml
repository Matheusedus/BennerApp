<Window x:Class="BennerApp.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:sys="clr-namespace:System;assembly=mscorlib"
        xmlns:models="clr-namespace:BennerApp.Models"
        xmlns:res="clr-namespace:BennerApp.Resources"
        Title="BennerApp - Teste Técnico" Height="560" Width="980">

    <!-- Resources para enum e conversor -->
    <Window.Resources>
        <!-- lista de valores do enum FormaPagamento para o ComboBox -->
        <ObjectDataProvider x:Key="FormaPagamentoValues"
                            MethodName="GetValues"
                            ObjectType="{x:Type sys:Enum}">
            <ObjectDataProvider.MethodParameters>
                <x:Type TypeName="models:FormaPagamento"/>
            </ObjectDataProvider.MethodParameters>
        </ObjectDataProvider>

        <!-- conversor p/ desabilitar botões quando Finalizado = true -->
        <res:InverseBoolConverter x:Key="InverseBoolConverter"/>

        <!-- Watermark/Placeholder para TextBox -->
        <Style x:Key="WatermarkTextBox" TargetType="TextBox">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TextBox">
                        <Grid>
                            <ScrollViewer x:Name="PART_ContentHost"/>
                            <TextBlock x:Name="Watermark"
                                   Text="{TemplateBinding Tag}"
                                   Foreground="#7A7A7A"
                                   Margin="6,0,0,0"
                                   IsHitTestVisible="False"
                                   VerticalAlignment="Center"
                                   Visibility="Collapsed"/>
                        </Grid>
                        <ControlTemplate.Triggers>
                            <Trigger Property="Text" Value="">
                                <Setter TargetName="Watermark" Property="Visibility" Value="Visible"/>
                            </Trigger>
                            <Trigger Property="IsKeyboardFocused" Value="True">
                                <Setter TargetName="Watermark" Property="Visibility" Value="Collapsed"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>

    <Grid Margin="10">
        <TabControl x:Name="Tabs">

            <!-- ============== PESSOAS ============== -->
            <TabItem Header="Pessoas">
                <Grid Margin="8">
                    <!-- AGORA SÃO 5 LINHAS -->
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <!-- 0: Filtros -->
                        <RowDefinition Height="Auto"/>
                        <!-- 1: Formulário de inclusão -->
                        <RowDefinition Height="Auto"/>
                        <!-- 2: Ações CRUD -->
                        <RowDefinition Height="2*"/>
                        <!-- 3: Grid de Pessoas -->
                        <RowDefinition Height="Auto"/>
                        <!-- 4: Filtros pedidos -->
                        <RowDefinition Height="*"/>
                        <!-- 5: Grid pedidos da pessoa -->
                    </Grid.RowDefinitions>

                    <!-- 0) FILTROS -->
                    <GroupBox Grid.Row="0" Header="Filtros — Pessoas" Padding="10" Margin="0,0,0,8">
                        <DockPanel LastChildFill="True">
                            <!-- Botões à direita -->
                            <StackPanel DockPanel.Dock="Right" Orientation="Horizontal" VerticalAlignment="Center">
                                <Button Content="Limpar" Width="80" Click="LimparFiltrosPessoas_Click"/>
                                <Separator Width="8" Opacity="0"/>
                                <Button Content="Incluir Pedido" Width="110" Click="IncluirPedido_Click"/>
                            </StackPanel>

                            <!-- Campos de busca -->
                            <StackPanel Orientation="Horizontal">
                                <!-- Nome -->
                                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                    <TextBlock Text="Nome:" VerticalAlignment="Center"/>
                                    <TextBox Width="220"
                 Margin="6,0,12,0"
                 Style="{StaticResource WatermarkTextBox}"
                 Tag="Buscar por nome..."
                 Text="{Binding Pessoas.FiltroNome, UpdateSourceTrigger=PropertyChanged}"/>
                                </StackPanel>

                                <!-- CPF -->
                                <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Margin="12,0,0,0">
                                    <TextBlock Text="CPF:" VerticalAlignment="Center"/>
                                    <TextBox Width="160"
                 Margin="6,0,0,0"
                 Style="{StaticResource WatermarkTextBox}"
                 Tag="Buscar por CPF..."
                 Text="{Binding Pessoas.FiltroCpf, UpdateSourceTrigger=PropertyChanged}"/>
                                </StackPanel>
                            </StackPanel>
                        </DockPanel>
                    </GroupBox>

                    <!-- 1) FORMULÁRIO DE INCLUSÃO -->
                    <StackPanel Orientation="Horizontal" Grid.Row="1" Margin="0,0,0,8">
                        <TextBlock Text="Nome:" VerticalAlignment="Center"/>
                        <TextBox x:Name="TxtNomePessoa" Width="160" Margin="6,0,12,0"/>

                        <TextBlock Text="CPF:" VerticalAlignment="Center"/>
                        <TextBox x:Name="TxtCpfPessoa" Width="130" Margin="6,0,12,0"/>

                        <TextBlock Text="Endereço:" VerticalAlignment="Center"/>
                        <TextBox x:Name="TxtEnderecoPessoa" Width="220" Margin="6,0,12,0"/>

                        <Button Content="Incluir Pessoa" Width="120" Click="AddPessoa_Click"/>
                    </StackPanel>

                    <!-- 2) AÇÕES CRUD (MOVIDAS PARA A LINHA 2) -->
                    <StackPanel Orientation="Horizontal" Grid.Row="2" Margin="0,0,0,8">
                        <Button Content="Salvar mudanças" Width="130" Click="SalvarPessoas_Click"/>
                        <Button Content="Excluir selecionado" Width="140" Margin="8,0,0,0" Click="ExcluirPessoa_Click"/>
                    </StackPanel>

                    <!-- 3) GRID DE PESSOAS (ATUALIZEI O ÍNDICE DA LINHA) -->
                    <DataGrid x:Name="PessoasGrid" Grid.Row="3"
              ItemsSource="{Binding Pessoas.Pessoas}"
              AutoGenerateColumns="False" CanUserAddRows="False" IsReadOnly="False"
              SelectionChanged="PessoasGrid_SelectionChanged">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Id" Binding="{Binding Id}" Width="60" IsReadOnly="True"/>
                            <DataGridTextColumn Header="Nome" Binding="{Binding Nome}" Width="*" />
                            <DataGridTextColumn Header="CPF" Binding="{Binding Cpf}" Width="150" />
                            <DataGridTextColumn Header="Endereço" Binding="{Binding Endereco}" Width="2*" />
                        </DataGrid.Columns>
                    </DataGrid>

                    <!-- 4) FILTROS DE PEDIDOS -->
                    <StackPanel Orientation="Horizontal" Grid.Row="4" Margin="0,10,0,6">
                        <TextBlock Text="Pedidos da pessoa selecionada:" FontWeight="Bold" Margin="0,0,12,0" VerticalAlignment="Center"/>
                        <CheckBox Content="Apenas entregues"  Margin="6,0,0,0" IsChecked="{Binding Pessoas.ApenasEntregues}"/>
                        <CheckBox Content="Apenas pagos"      Margin="12,0,0,0" IsChecked="{Binding Pessoas.ApenasPagos}"/>
                        <CheckBox Content="Apenas pendentes"  Margin="12,0,0,0" IsChecked="{Binding Pessoas.ApenasPendentes}"/>
                    </StackPanel>

                    <!-- 5) GRID DE PEDIDOS DA PESSOA -->
                    <DataGrid Grid.Row="5"
              ItemsSource="{Binding Pessoas.PedidosDaPessoa}"
              AutoGenerateColumns="False" CanUserAddRows="False" IsReadOnly="True">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Id" Binding="{Binding Id}" Width="60"/>
                            <DataGridTextColumn Header="Data" Binding="{Binding DataVenda, StringFormat=\{0:dd/MM/yyyy HH:mm\}}" Width="140" />
                            <DataGridTextColumn Header="Total" Binding="{Binding ValorTotal, StringFormat=\{0:C\}}" Width="120"/>
                            <DataGridTextColumn Header="Pagamento" Binding="{Binding FormaPagamento}" Width="120"/>
                            <DataGridTextColumn Header="Status" Binding="{Binding Status}" Width="120"/>
                            <DataGridTemplateColumn Header="Ações" Width="200">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                            <Button Content="Pago"     Margin="2" Tag="{Binding Id}"
                        IsEnabled="{Binding Status, Converter={StaticResource StatusEnableConverter}, ConverterParameter=Pago}"
                        Click="PedidoPago_Click"/>
                                            <Button Content="Enviado"  Margin="2" Tag="{Binding Id}"
                        IsEnabled="{Binding Status, Converter={StaticResource StatusEnableConverter}, ConverterParameter=Enviado}"
                        Click="PedidoEnviado_Click"/>
                                            <Button Content="Recebido" Margin="2" Tag="{Binding Id}"
                        IsEnabled="{Binding Status, Converter={StaticResource StatusEnableConverter}, ConverterParameter=Recebido}"
                        Click="PedidoRecebido_Click"/>
                                        </StackPanel>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                        </DataGrid.Columns>
                    </DataGrid>

                </Grid>
            </TabItem>

            <!-- ============== PRODUTOS ============== -->
            <TabItem Header="Produtos">
                <Grid Margin="8">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <!-- filtros -->
                        <RowDefinition Height="Auto"/>
                        <!-- formulário inclusão -->
                        <RowDefinition Height="Auto"/>
                        <!-- ações CRUD -->
                        <RowDefinition Height="*"/>
                        <!-- grid produtos -->
                    </Grid.RowDefinitions>

                    <!-- 0) FILTROS -->
                    <GroupBox Grid.Row="0" Header="Filtros — Produtos" Padding="10" Margin="0,0,0,8">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="Nome:" VerticalAlignment="Center"/>
                            <TextBox Width="160" Margin="6,0,12,0"
                 Style="{StaticResource WatermarkTextBox}"
                 Tag="Buscar por nome..."
                 Text="{Binding Produtos.FiltroNome, UpdateSourceTrigger=PropertyChanged}"/>

                            <TextBlock Text="Código:" VerticalAlignment="Center"/>
                            <TextBox Width="120" Margin="6,0,12,0"
                 Style="{StaticResource WatermarkTextBox}"
                 Tag="Buscar por código..."
                 Text="{Binding Produtos.FiltroCodigo, UpdateSourceTrigger=PropertyChanged}"/>

                            <TextBlock Text="Valor Mín.:" VerticalAlignment="Center"/>
                            <TextBox Width="80" Margin="6,0,12,0"
                 Style="{StaticResource WatermarkTextBox}"
                 Tag="De..."
                 Text="{Binding Produtos.ValorMin, UpdateSourceTrigger=PropertyChanged}"/>

                            <TextBlock Text="Valor Máx.:" VerticalAlignment="Center"/>
                            <TextBox Width="80" Margin="6,0,12,0"
                 Style="{StaticResource WatermarkTextBox}"
                 Tag="Até..."
                 Text="{Binding Produtos.ValorMax, UpdateSourceTrigger=PropertyChanged}"/>

                            <Button Content="Limpar" Width="80" Click="LimparFiltrosProdutos_Click"/>
                        </StackPanel>
                    </GroupBox>

                    <!-- 1) FORMULÁRIO DE INCLUSÃO -->
                    <StackPanel Orientation="Horizontal" Grid.Row="1" Margin="0,0,0,8">
                        <TextBlock Text="Nome:" VerticalAlignment="Center"/>
                        <TextBox x:Name="TxtNomeProduto" Width="160" Margin="6,0,12,0"/>

                        <TextBlock Text="Código:" VerticalAlignment="Center"/>
                        <TextBox x:Name="TxtCodigoProduto" Width="120" Margin="6,0,12,0"/>

                        <TextBlock Text="Valor:" VerticalAlignment="Center"/>
                        <TextBox x:Name="TxtValorProduto" Width="100" Margin="6,0,12,0"/>

                        <Button Content="Incluir Produto" Width="120" Click="AddProduto_Click"/>
                    </StackPanel>

                    <!-- 2) AÇÕES CRUD -->
                    <StackPanel Orientation="Horizontal" Grid.Row="2" Margin="0,0,0,8">
                        <Button Content="Salvar mudanças" Width="130" Click="SalvarProdutos_Click"/>
                        <Button Content="Excluir selecionado" Width="140" Margin="8,0,0,0" Click="ExcluirProduto_Click"/>
                    </StackPanel>

                    <!-- 3) GRID DE PRODUTOS -->
                    <DataGrid x:Name="ProdutosGrid" Grid.Row="3"
              ItemsSource="{Binding Produtos.Produtos}"
              AutoGenerateColumns="False" CanUserAddRows="False" IsReadOnly="False">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Id" Binding="{Binding Id}" Width="60" IsReadOnly="True"/>
                            <DataGridTextColumn Header="Nome" Binding="{Binding Nome}" Width="2*"/>
                            <DataGridTextColumn Header="Código" Binding="{Binding Codigo}" Width="*" />
                            <DataGridTextColumn Header="Valor" Binding="{Binding Valor, StringFormat=\{0:C\}}" Width="*" />
                        </DataGrid.Columns>
                    </DataGrid>

                </Grid>
            </TabItem>

            <!-- ============== PEDIDOS ============== -->
            <TabItem Header="Pedidos">
                <Grid Margin="8">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- CABEÇALHO: pessoa + pagamento -->
                    <StackPanel Orientation="Horizontal" Grid.Row="0" Margin="0,0,0,8">
                        <TextBlock Text="Pessoa:" VerticalAlignment="Center"/>
                        <ComboBox Width="240" Margin="6,0,16,0"
                              ItemsSource="{Binding Pedidos.Pessoas}"
                              DisplayMemberPath="Nome"
                              SelectedValuePath="Id"
                              SelectedValue="{Binding Pedidos.PessoaSelecionadaId}"/>
                        <TextBlock Text="Pagamento:" VerticalAlignment="Center"/>
                        <ComboBox Width="160" Margin="6,0,0,0"
                                  ItemsSource="{Binding Source={StaticResource FormaPagamentoValues}}"
                                  SelectedItem="{Binding Pedidos.Forma}"/>
                    </StackPanel>

                    <!-- ADIÇÃO DE ITENS -->
                    <StackPanel Orientation="Horizontal" Grid.Row="1" Margin="0,0,0,8">
                        <TextBlock Text="Produto:" VerticalAlignment="Center"/>
                        <ComboBox x:Name="CbProduto" Width="320" Margin="6,0,16,0"
                                  ItemsSource="{Binding Pedidos.Produtos}" 
                                  DisplayMemberPath="Nome"/>
                        <TextBlock Text="Qtd:" VerticalAlignment="Center"/>
                        <TextBox x:Name="TxtQtd" Width="60" Margin="6,0,16,0" Text="1"/>
                        <Button Content="Adicionar item" Click="AddItem_Click"
                                IsEnabled="{Binding Pedidos.Finalizado, Converter={StaticResource InverseBoolConverter}}"/>
                    </StackPanel>

                    <!-- ITENS DO PEDIDO -->
                    <DataGrid Grid.Row="2" ItemsSource="{Binding Pedidos.Itens}"
                              AutoGenerateColumns="False" CanUserAddRows="False"
                              IsReadOnly="{Binding Pedidos.Finalizado}">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Produto" Binding="{Binding NomeProduto}" Width="2*"/>
                            <DataGridTextColumn Header="Valor" Binding="{Binding ValorUnit}" Width="*" />
                            <DataGridTextColumn Header="Qtd" Binding="{Binding Quantidade}" Width="*" />
                            <DataGridTextColumn Header="Subtotal" Binding="{Binding Subtotal}" Width="*" IsReadOnly="True"/>
                        </DataGrid.Columns>
                    </DataGrid>

                    <!-- RODAPÉ -->
                    <StackPanel Orientation="Horizontal" Grid.Row="3" HorizontalAlignment="Right" Margin="0,8,0,0">
                        <TextBlock Text="Total:" VerticalAlignment="Center" FontWeight="Bold" Margin="0,0,8,0"/>
                        <TextBlock Text="{Binding Pedidos.Total}" VerticalAlignment="Center" FontWeight="Bold" Margin="0,0,16,0"/>
                        <Button Content="Finalizar Pedido" Click="FinalizarPedido_Click"
                                IsEnabled="{Binding Pedidos.Finalizado, Converter={StaticResource InverseBoolConverter}}"/>
                    </StackPanel>
                </Grid>
            </TabItem>

        </TabControl>
    </Grid>
</Window>
